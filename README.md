# YurongOS 雨融

## 简介

YurongOS（雨融）是一个运行于 Intel IA-32 平台的玩具级操作系统，使用 C++ 和汇编编写，用很新的工具链构建。

系统的设计与实现参考自以下项目：

* 同济大学计算机系《操作系统》课程教学实验系统 Unix V6++ OOS
* 踌躇月光操作系统课程实验系统 onix

主要在以下材料的帮助下推进：

* OSDev 网站
* 同济大学《操作系统原理》

实现计划（别骂了，确实还差很多没做呢）：

* [X] 启动引导
* [X] 内存检测（获取基本信息）
* [X] 文本显示驱动
* [X] 通用开发库
* [X] 中断结构准备
* [ ] 内存检测（处理）
* [ ] 内核区分页
* [ ] 中断完善
* [ ] 用户区分页
* [ ] 文件系统（设计）
* [ ] 文件系统（外置编辑器）
* [ ] 高速缓存
* [ ] 文件系统（内核）
* [ ] ELF 解析
* [ ] 进程模型
* [ ] Shell

## 参考开发环境

这里列出一个参考环境。其他环境的开发体验不做保证。

> OS: Arch Linux
>
> Kernel: GNU/Linux 6.0.12
>
> Graphics: X11
>
> GCC: 12.2.0
>
> NASM: 2.15.05
>
> GNU Make: 4.3
>
> Qemu: 7.1.0

## 系统盘布局

|  盘块号  | 大小  |       用途       |
| :------: | ----- | :---------------: |
|    0    | 512B  |     启动引导     |
|    1    | 512B  |        空        |
| [2, 799] | 399KB | kernel 二进制文件 |
|          |       |       待定       |

## 物理内存布局

使用平铺模型（flat model），即描述符内注明的内存基地址就是 0，不做奇怪的变换。

地址使用16进制书写（带单位的除外）。

|           起始地址           | 终止地址（含） |         大小         |                                                                                                   用途和备注                                                                                                   |
| :--------------------------: | :------------: | :-------------------: | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------: |
|             1000             |      1003      |          4B          |                                                                                               内存检测 ards count                                                                                               |
|             2000             |       ?       | ?<br />一般不超过400B |                                                                                              内存检测 ards buffer                                                                                              |
|             7c00             |      7dff      |         512B         |                                                                                                  启动引导程序                                                                                                  |
| 7e00（理论界限）<br />31.5KB |     2f000     |        156.5KB        | 核心栈<br />从终止位置开始<br />向低位生长<br /><br />注意，生长时可能突破7e00，一直达到0位置<br />即：实际核心栈大小可以增长到 188KB<br />但是，低位内存保留有内存检测信息<br />核心栈突破限制可能带来安全隐患 |
|            30000            |     9fbff     |         447KB         |                                                        系统内核<br /><br />注意：修改内核加载地址时，需要同步<br />在链接脚本和启动引导相关位置做修改。                                                        |
|             1MB             |   不超过 3GB   |     最好大于 32MB     |                                                                                                      待定                                                                                                      |
